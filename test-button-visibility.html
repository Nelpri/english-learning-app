<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Visibilidad del Bot√≥n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.3); }
        .error { background: rgba(244, 67, 54, 0.3); }
        .info { background: rgba(33, 150, 243, 0.3); }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .button-test {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test - Visibilidad del Bot√≥n "Siguiente Lecci√≥n"</h1>
    
    <div class="test-container">
        <h2>üìä Estado Actual del Usuario</h2>
        <div id="userStatus" class="status info">Cargando...</div>
        
        <h2>üîß Test del Bot√≥n</h2>
        <div class="button-test">
            <button onclick="testButtonVisibility()">Verificar Visibilidad del Bot√≥n</button>
            <button onclick="forceButtonVisible()">Forzar Bot√≥n Visible</button>
            <button onclick="testButtonFunctionality()">Probar Funcionalidad del Bot√≥n</button>
            <button onclick="checkLearnSection()">Verificar Secci√≥n Aprender</button>
        </div>
        
        <div id="buttonStatus" class="status info">Esperando verificaci√≥n...</div>
    </div>
    
    <div class="test-container">
        <h2>üìù Logs del Sistema</h2>
        <div id="systemLogs" class="log">Esperando acciones...</div>
    </div>

    <!-- Incluir todos los m√≥dulos necesarios -->
    <script src="script1.js/data.js"></script>
    <script src="script1.js/auth.js"></script>
    <script src="script1.js/lesson.js"></script>
    <script src="script1.js/practice.js"></script>
    <script src="script1.js/vocabulary.js"></script>
    <script src="script1.js/progress.js"></script>
    <script src="script1.js/achievements.js"></script>
    <script src="script1.js/diagnostic.js"></script>
    <script src="script1.js/navigation.js"></script>
    <script src="script1.js/storage.js"></script>
    <script src="script1.js/utils.js"></script>
    <script src="script1.js/module-progress.js"></script>
    <script src="script1.js/level-tests.js"></script>
    <script src="script1.js/test-interface.js"></script>
    <script src="script1.js/level-test-manager.js"></script>
    <script src="script.js"></script>

    <script>
        // Interceptar console.log para mostrar en la p√°gina
        const originalLog = console.log;
        const logContainer = document.getElementById('systemLogs');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logEntry = document.createElement('div');
            logEntry.textContent = args.join(' ');
            logEntry.style.marginBottom = '5px';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        // Funci√≥n para mostrar el estado del usuario
        function updateUserStatus() {
            const statusDiv = document.getElementById('userStatus');
            
            if (window.appState) {
                statusDiv.innerHTML = `
                    <strong>Usuario:</strong> ${window.appState.currentUser || 'No registrado'}<br>
                    <strong>Nivel:</strong> ${window.appState.currentLevel || 1}<br>
                    <strong>XP:</strong> ${window.appState.currentXP || 0}<br>
                    <strong>Lecci√≥n:</strong> ${window.appState.currentLesson || 0}<br>
                    <strong>MCER:</strong> ${window.appState.diagnosticLevel || 'No evaluado'}
                `;
            } else {
                statusDiv.innerHTML = '‚ùå appState no disponible';
            }
        }

        // Funci√≥n para verificar la visibilidad del bot√≥n
        function testButtonVisibility() {
            console.log("üß™ Verificando visibilidad del bot√≥n...");
            
            const nextLessonBtn = document.getElementById('nextLessonBtn');
            const statusDiv = document.getElementById('buttonStatus');
            
            if (!nextLessonBtn) {
                console.log("‚ùå Bot√≥n 'nextLessonBtn' no encontrado en el DOM");
                statusDiv.innerHTML = "‚ùå Bot√≥n no encontrado en el DOM";
                statusDiv.className = "status error";
                return;
            }
            
            const buttonInfo = {
                encontrado: !!nextLessonBtn,
                visible: nextLessonBtn.offsetParent !== null,
                display: window.getComputedStyle(nextLessonBtn).display,
                visibility: window.getComputedStyle(nextLessonBtn).visibility,
                opacity: window.getComputedStyle(nextLessonBtn).opacity,
                disabled: nextLessonBtn.disabled,
                classes: nextLessonBtn.className,
                textContent: nextLessonBtn.textContent,
                title: nextLessonBtn.title
            };
            
            console.log("üîç Informaci√≥n del bot√≥n:", buttonInfo);
            
            if (buttonInfo.visible && !buttonInfo.disabled) {
                statusDiv.innerHTML = "‚úÖ Bot√≥n visible y habilitado";
                statusDiv.className = "status success";
            } else if (buttonInfo.visible && buttonInfo.disabled) {
                statusDiv.innerHTML = "‚ö†Ô∏è Bot√≥n visible pero deshabilitado";
                statusDiv.className = "status info";
            } else {
                statusDiv.innerHTML = "‚ùå Bot√≥n no visible";
                statusDiv.className = "status error";
            }
        }

        // Funci√≥n para forzar la visibilidad del bot√≥n
        function forceButtonVisible() {
            console.log("üîß Forzando visibilidad del bot√≥n...");
            
            const nextLessonBtn = document.getElementById('nextLessonBtn');
            if (!nextLessonBtn) {
                console.log("‚ùå Bot√≥n no encontrado");
                return;
            }
            
            // Forzar visibilidad
            nextLessonBtn.style.display = 'inline-block';
            nextLessonBtn.style.visibility = 'visible';
            nextLessonBtn.style.opacity = '1';
            nextLessonBtn.disabled = false;
            nextLessonBtn.classList.remove('btn-disabled');
            nextLessonBtn.classList.add('btn-primary');
            
            console.log("‚úÖ Bot√≥n forzado a ser visible");
            testButtonVisibility();
        }

        // Funci√≥n para probar la funcionalidad del bot√≥n
        function testButtonFunctionality() {
            console.log("üß™ Probando funcionalidad del bot√≥n...");
            
            if (typeof window.updateNextLessonButton === 'function') {
                console.log("üîÑ Llamando a updateNextLessonButton()...");
                window.updateNextLessonButton();
                
                setTimeout(() => {
                    console.log("üîÑ Llamando a ensureLearnSectionVisible()...");
                    if (typeof window.ensureLearnSectionVisible === 'function') {
                        window.ensureLearnSectionVisible();
                    }
                    
                    setTimeout(() => {
                        testButtonVisibility();
                    }, 500);
                }, 500);
            } else {
                console.log("‚ùå Funci√≥n updateNextLessonButton no disponible");
            }
        }

        // Funci√≥n para verificar la secci√≥n de aprender
        function checkLearnSection() {
            console.log("üß™ Verificando secci√≥n de aprender...");
            
            const learnSection = document.getElementById('learn');
            const learnTab = document.querySelector('.nav-tab[data-tab="learn"]');
            
            if (!learnSection || !learnTab) {
                console.log("‚ùå Secci√≥n de aprender no encontrada");
                return;
            }
            
            const sectionInfo = {
                seccionEncontrada: !!learnSection,
                tabEncontrado: !!learnTab,
                seccionActiva: learnSection.classList.contains('active'),
                tabActivo: learnTab.classList.contains('active'),
                seccionVisible: learnSection.style.display !== 'none'
            };
            
            console.log("üîç Informaci√≥n de la secci√≥n:", sectionInfo);
            
            if (sectionInfo.seccionActiva && sectionInfo.tabActivo) {
                console.log("‚úÖ Secci√≥n de aprender est√° activa");
            } else {
                console.log("‚ö†Ô∏è Secci√≥n de aprender no est√° activa");
                
                // Intentar activarla
                if (typeof window.ensureLearnSectionVisible === 'function') {
                    console.log("üîÑ Intentando activar secci√≥n...");
                    window.ensureLearnSectionVisible();
                }
            }
        }

        // Inicializar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ P√°gina de test de bot√≥n cargada");
            updateUserStatus();
            
            // Verificar bot√≥n inmediatamente
            setTimeout(() => {
                testButtonVisibility();
                checkLearnSection();
            }, 1000);
        });
    </script>
</body>
</html>
